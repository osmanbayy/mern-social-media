import { useEffect, useState } from "react";

const OSSvg = ({ forceDark, ...props }) => {
  const getTheme = () => {
    // Check data-theme attribute first
    let dataTheme = document.documentElement.getAttribute("data-theme");
    
    // If data-theme doesn't exist, get from localStorage and set it
    if (!dataTheme) {
      const storedTheme = localStorage.getItem("theme") || "dark";
      document.documentElement.setAttribute("data-theme", storedTheme);
      return storedTheme;
    }
    
    return dataTheme;
  };
  
  const [theme, setTheme] = useState(() => {
    if (forceDark) return "dark";
    return getTheme();
  });

  useEffect(() => {
    if (forceDark) {
      setTheme("dark");
      return;
    }
    
    // Check once more after initial render
    const updateTheme = () => {
      setTheme(getTheme());
    };
    
    // Update immediately
    updateTheme();
    
    // Check once more in the next frame (for DOM updates)
    requestAnimationFrame(() => {
      updateTheme();
    });

    const observer = new MutationObserver(() => {
      setTheme(getTheme());
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["data-theme"],
    });
    
    const handleStorageChange = (e) => {
      if (e.key === "theme" || !e.key) {
        setTheme(getTheme());
      }
    };
    window.addEventListener("storage", handleStorageChange);

    return () => {
      observer.disconnect();
      window.removeEventListener("storage", handleStorageChange);
    };
  }, [forceDark]);
  return (
    <>
      {theme === "dark" ? (
        <svg
          version="1.1"
          viewBox="0 0 1280 1280"
          preserveAspectRatio="xMidYMid meet"
          {...props}
        >
          <path
            transform="translate(438,223)"
            d="m0 0h30l31 3 22 5 27 9 20 9 26 13 24 11 10 3 7 1h17l10-4 6-4 4-5 3-10 1-7v-10l5-2h9l2 4-1 250-1 1h-11l-3-3-2-32-5-32-5-20-7-21-8-18-10-18-8-12-12-16-11-12-13-12-17-13-14-9-17-8-20-7-17-5-18-3-17-1h-15l-25 2-25 6-12 5-15 9-13 11-10 14-8 17-4 13-2 11-1 17 2 26 4 20 7 21 8 16 8 14 10 14 12 14 9 10 13 13 11 9 13 11 19 14 18 13 22 15 21 14 19 12 18 12 22 15 14 10 21 16 13 10 13 11 10 9 29 29 11 14 10 14 10 18 9 19 6 18 4 19 3 23v31l-3 23-5 22-7 21-10 21-8 12-9 11-11 12-16 13-18 12-16 8-18 7-26 8-26 5-25 3-13 1h-49l-30-3-24-4-25-7-32-12-29-13-24-8-10-2-15-1-21 3-12 6-6 5-5 9-2 13-1 1h-12l-1-1v-323h13l1 1 1 30 3 38 5 32 9 38 9 26 9 20 8 16 13 20 10 13 9 10 14 14 14 11 14 10 12 7 18 8 17 6 26 6 24 3 13 1h29l31-5 24-7 16-7 14-9 13-11 9-11 10-17 6-16 4-17 2-14v-20l-4-24-7-21-11-21-10-14-10-13-12-13-24-24-11-9-14-11-21-16-19-14-40-28-12-8-20-14-36-26-21-16-14-11-13-11-11-9-12-11-17-17-7-8-13-16-12-18-8-14-8-17-8-24-3-16-1-9v-32l3-19 6-21 7-17 12-21 13-16 16-16 17-13 15-10 19-10 25-10 25-7 30-5z"
            fill="#FEFEFE"
          />
          <path
            transform="translate(732,256)"
            d="m0 0 10 1 42 10 28 10 24 11 22 11 21 13 19 14 14 11 10 9 8 7 20 20v2h2l7 8 13 16 10 14 14 21 12 21 14 29 9 24 9 28 6 26 5 30 4 43v33l-3 31-5 30-7 29-7 22-7 19-9 21-10 20-11 19-16 24-11 14-11 13-9 11-7 7-7 8-14 13-14 11-18 14-26 17-16 9-22 11-27 11-29 9-25 6-20 3-34 3h-25l-3-2 16-9 6-3 44-5 19-5 20-7 19-9 18-11 13-11 11-9 14-15 11-14 7-10 12-19 11-21 11-26 12-36 9-36 7-42 4-36 2-35v-30l-3-54-4-38-6-36-9-38-9-29-9-24-10-23-12-22-11-18-10-14-9-11-12-13-14-13-17-13-19-12-25-12-17-6z"
            fill="#FEFEFE"
          />
          <path
            transform="translate(299,611)"
            d="m0 0 6 4 16 13 12 9 17 13 19 14 18 13 17 12 14 10 10 8 1 3 3 29 6 35 5 22 5 19 7 22 8 22 10 23 10 20 14 23 12 17 11 13 7 7v2l-27 4-14 1h-23l-9-2-11-7-15-13-14-13-7-8-11-12-9-11-12-15-10-15-15-25-12-23-13-31-11-33-7-29-5-28-3-31-1-36v-25z"
            fill="#FEFEFE"
          />
          <path
            transform="translate(506,293)"
            d="m0 0 8 1 21 8 9 4-2 4-10 9-18 18-10 13-13 18-9 15-12 23-14 32-11 31-4-2-12-12-8-10-11-14-12-21-6-14-2-5v-6l10-10 7-8 22-22 11-9 18-14 20-14 18-10z"
            fill="#FEFEFE"
          />
        </svg>
      ) : (
        <svg
          version="1.1"
          viewBox="0 0 1280 1280"
          preserveAspectRatio="xMidYMid meet"
          {...props}
        >
          <path
            transform="translate(478,221)"
            d="m0 0h43l24 3 23 5 26 9 22 10 19 10 26 12 6 2 20 2 12-2 10-6 5-8 3-15 1-10h13l1 1v246l-1 1h-13l-3-33-4-27-6-25-9-25-10-21-13-21-13-17-11-12-14-12-16-12-13-8-17-8-27-9-20-4-25-2-25 1-20 3-18 5-16 8-16 12-8 9-8 13-7 16-4 17-1 8v20l2 19 4 18 5 16 9 19 9 15 12 16 9 10 7 8 13 13 8 7 13 11 19 14 18 13 20 14 15 10 20 13 30 20 22 15 19 14 21 16 10 8 11 10 8 7 20 20 9 11 10 13 11 18 9 17 8 21 5 20 4 30v23l-3 25-5 23-7 20-10 21-10 15-12 14-7 7-17 13-15 10-21 10-27 9-25 6-27 4-21 2h-46l-37-4-21-4-23-7-27-10-29-13-24-8-18-3h-9l-15 2-10 4-9 6-6 9-2 7-1 8-1 1h-10l-2-1-1-20v-296l5-1 9 1 2 43 4 37 7 36 6 22 7 20 7 17 8 16 8 14 9 13 10 13 4 4v2h2l7 8 10 9 14 11 15 10 25 12 21 7 26 5 34 3h20l21-2 20-4 25-8 13-7 14-10 11-10 10-14 8-16 5-16 3-16 1-7v-20l-4-24-6-18-8-17-9-14-9-12-9-11-11-12-14-14-8-7-13-11-16-12-21-16-18-13-16-11-20-14-15-10-17-12-36-26-17-13-17-14-16-13-12-11-19-19-9-11-11-13-12-18-10-18-8-19-6-21-2-12-1-14v-16l2-20 5-21 8-20 10-18 9-13 9-10 5-6 8-7 16-13 19-12 16-8 16-7 22-7 22-5 22-3z"
            fill="#020202"
          />
          <path
            transform="translate(786,258)"
            d="m0 0 18 4 25 7 19 7 16 7 21 10 18 10 21 14 21 16 13 11 15 14 9 9 7 8 12 14 14 19 8 12 10 16 10 18 12 25 10 27 8 26 7 31 4 28 3 35v34l-2 22-5 32-7 30-8 26-11 28-11 23-11 20-20 30-11 14-12 14-9 10-7 8-8 8-8 7-12 10-16 12-17 12-19 12-17 9-22 10-24 9-34 10-20 4-35 4h-13l1-3 14-9 4-3 25-4 26-8 21-9 16-9 14-10 14-12 15-15 11-14 7-10 9-14 10-18 12-26 12-34 7-26 5-22 6-36 3-26 2-25 1-22v-25l-3-52-3-31-5-33-6-29-8-30-9-27-12-29-11-22-12-20-11-16-9-11-14-15-14-13-16-12-18-11-26-13z"
            fill="#020202"
          />
          <path
            transform="translate(348,618)"
            d="m0 0 4 2 15 12 12 9 21 16 17 12 36 26 19 13 4 4 3 16 6 35 8 34 9 29 8 21 8 19 10 19 10 18 8 12 9 12 2 5-17 2h-34l-20-2-12-3-8-6-9-9-7-8-13-15-11-14-10-14-15-24-14-27-9-20-10-27-8-28-6-29-4-28-1-12-1-25z"
            fill="#010101"
          />
          <path
            transform="translate(535,301)"
            d="m0 0 14 3 29 9-1 4h-2l-2 4-9 8-9 11-10 13-14 21-12 22-13 29-8 22-4-2-9-9-11-14-7-10-8-14-5-12-4-12v-5l12-13 8-8 8-7 17-14 19-14 13-8z"
            fill="#030303"
          />
        </svg>
      )}
    </>
  );
};
export default OSSvg;
